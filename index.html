OCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Universo X</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Inter:wght@400;600;800&display=swap');
    
    body { 
      margin: 0; 
      overflow-x: hidden;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      font-family: 'Inter', sans-serif;
    }
    
    .handwriting { font-family: 'Caveat', cursive; }
    
    .note-card { 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: linear-gradient(145deg, #fff9e6 0%, #fef5d4 100%);
      box-shadow: 
        0 4px 6px rgba(0,0,0,0.1),
        0 0 20px rgba(255,215,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.5);
      border: 2px solid rgba(139, 92, 246, 0.3);
    }
    
    .note-card:hover { 
      transform: translateY(-8px) scale(1.02);
      box-shadow: 
        0 20px 40px rgba(0,0,0,0.3),
        0 0 40px rgba(139, 92, 246, 0.6),
        0 0 60px rgba(236, 72, 153, 0.4),
        inset 0 1px 0 rgba(255,255,255,0.8);
    }
    
    .note-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #8b5cf6, #ec4899, #06b6d4, #8b5cf6);
      border-radius: inherit;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      filter: blur(10px);
    }
    
    .note-card:hover::before {
      opacity: 0.7;
      animation: glow 2s ease-in-out infinite;
    }
    
    @keyframes glow {
      0%, 100% { filter: blur(10px) brightness(1); }
      50% { filter: blur(15px) brightness(1.3); }
    }
    
    @keyframes pulse { 
      0%, 100% { opacity: 1; transform: scale(1); } 
      50% { opacity: 0.8; transform: scale(1.05); } 
    }
    
    .animate-pulse { 
      animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
    }
    
    .neon-text {
      text-shadow: 
        0 0 10px rgba(139, 92, 246, 0.8),
        0 0 20px rgba(139, 92, 246, 0.6),
        0 0 30px rgba(236, 72, 153, 0.4);
    }
    
    .paper-texture {
      background-image: 
        repeating-linear-gradient(
          0deg,
          rgba(139, 92, 246, 0.03) 0px,
          transparent 1px,
          transparent 2px,
          rgba(139, 92, 246, 0.03) 3px
        ),
        repeating-linear-gradient(
          90deg,
          rgba(236, 72, 153, 0.03) 0px,
          transparent 1px,
          transparent 2px,
          rgba(236, 72, 153, 0.03) 3px
        );
    }
    
    .btn-neon {
      position: relative;
      background: linear-gradient(145deg, #8b5cf6, #ec4899);
      box-shadow: 
        0 4px 15px rgba(139, 92, 246, 0.4),
        0 0 20px rgba(236, 72, 153, 0.3);
      transition: all 0.3s;
    }
    
    .btn-neon:hover {
      box-shadow: 
        0 6px 25px rgba(139, 92, 246, 0.6),
        0 0 40px rgba(236, 72, 153, 0.5);
      transform: translateY(-2px);
    }
    
    .modal-paper {
      background: linear-gradient(145deg, #fff9e6 0%, #fef5d4 100%);
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.5),
        0 0 40px rgba(139, 92, 246, 0.4),
        inset 0 2px 4px rgba(255,255,255,0.6);
    }
    
    .line-clamp-2 { 
      display: -webkit-box; 
      -webkit-line-clamp: 2; 
      -webkit-box-orient: vertical; 
      overflow: hidden; 
    }
    
    .line-clamp-4 { 
      display: -webkit-box; 
      -webkit-line-clamp: 4; 
      -webkit-box-orient: vertical; 
      overflow: hidden; 
    }
    
    input, textarea {
      background: rgba(255, 249, 230, 0.9);
      border: 2px solid rgba(139, 92, 246, 0.3);
      color: #1a1a2e;
      transition: all 0.3s;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: #8b5cf6;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
    }
    
    .tag-neon {
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.6);
    }
  </style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash" class="fixed inset-0 flex items-center justify-center z-50" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
  <div class="text-center animate-pulse">
    <img src="https://i.imgur.com/your-image.png" alt="Cientista" class="w-48 h-48 mx-auto mb-6 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" style="filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.8));">
    <div class="text-8xl mb-4" style="display:none; filter: drop-shadow(0 0 30px rgba(236, 72, 153, 0.8));">üêµ</div>
    <h1 class="text-6xl font-bold text-white mb-2 neon-text handwriting">Meu Universo X</h1>
    <p class="text-2xl text-purple-300">Suas ideias conectadas ‚ú®</p>
  </div>
</div>

<!-- App -->
<div id="app" style="display:none">
  <!-- Header -->
  <div class="bg-gradient-to-r from-purple-900/50 to-pink-900/50 backdrop-blur-md border-b-2 border-purple-500/30 p-6 paper-texture">
    <div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
      <div class="flex items-center gap-4">
        <img src="https://i.imgur.com/your-image.png" alt="Cientista" class="w-12 h-12 object-contain" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%220.9em%22 font-size=%2290%22>üêµ</text></svg>'" style="filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.8));">
        <h1 class="text-3xl font-bold text-white neon-text handwriting">Meu Universo X</h1>
      </div>
      
      <div class="flex items-center gap-2 flex-1 max-w-md">
        <div class="relative flex-1">
          <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-400 text-xl">üîç</span>
          <input id="searchInput" type="text" placeholder="Buscar notas m√°gicas..." class="w-full pl-12 pr-4 py-3 rounded-xl font-medium text-lg">
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <button id="btnAdd" class="btn-neon p-3 rounded-xl text-white font-bold text-xl">‚ûï Nova</button>
        <button id="btnGrid" class="btn-neon p-3 rounded-xl text-white text-xl">üìä</button>
        <button id="btnGraph" class="p-3 bg-purple-800/50 hover:bg-purple-700/70 rounded-xl text-white text-xl transition">üåê</button>
        <button id="btnExport" class="p-3 bg-purple-800/50 hover:bg-purple-700/70 rounded-xl text-white text-xl transition">‚¨áÔ∏è</button>
        <label class="p-3 bg-purple-800/50 hover:bg-purple-700/70 rounded-xl text-white text-xl transition cursor-pointer">
          ‚¨ÜÔ∏è
          <input type="file" id="importFile" accept=".json" class="hidden">
        </label>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="max-w-7xl mx-auto p-6">
    <!-- Grid View -->
    <div id="gridView" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    
    <!-- Graph View -->
    <div id="graphView" style="display:none" class="relative">
      <canvas id="canvas3d" class="w-full rounded-2xl shadow-2xl" style="height:600px; box-shadow: 0 0 60px rgba(139, 92, 246, 0.4);"></canvas>
      <div class="absolute top-6 left-6 modal-paper p-6 rounded-2xl" style="border: 2px solid rgba(139, 92, 246, 0.5);">
        <p class="text-lg font-bold text-purple-900 handwriting">üîÆ Clique nas esferas m√°gicas!</p>
        <p class="text-md text-purple-700">‚ú® Conex√µes = hashtags em comum</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-40" style="display:none">
  <div class="modal-paper rounded-3xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" style="border: 3px solid rgba(139, 92, 246, 0.5);">
    <div class="p-8">
      <div class="flex justify-between items-start mb-6">
        <div class="flex-1">
          <div id="viewMode">
            <h2 id="modalTitle" class="text-4xl font-bold mb-6 text-purple-900 handwriting"></h2>
            <p id="modalContent" class="text-xl text-gray-800 whitespace-pre-wrap leading-relaxed"></p>
            <div id="modalTags" class="mt-6 flex flex-wrap gap-3"></div>
          </div>
          <div id="editMode" style="display:none">
            <input id="editTitle" type="text" class="w-full text-3xl font-bold rounded-xl px-4 py-3 mb-4 handwriting">
            <div class="flex items-center gap-3 mb-4">
              <button id="btnColorPicker" class="p-3 rounded-xl text-2xl btn-neon">üé®</button>
              <div id="colorPicker" class="flex flex-wrap gap-2 p-3 rounded-xl" style="display:none; background: rgba(255, 249, 230, 0.9);"></div>
            </div>
            <textarea id="editContent" class="w-full h-80 rounded-xl px-4 py-3 resize-none text-lg" placeholder="Escreva sua nota aqui... Use #hashtags para conectar ideias! ‚ú®"></textarea>
          </div>
        </div>
        <button id="btnCloseModal" class="ml-4 p-3 hover:bg-purple-200/50 rounded-xl text-2xl transition">‚úñÔ∏è</button>
      </div>

      <div class="flex flex-wrap gap-3 mt-8 pt-6 border-t-2 border-purple-300">
        <button id="btnEdit" class="px-6 py-3 btn-neon rounded-xl text-white font-bold text-lg">‚úèÔ∏è Editar</button>
        <button id="btnSave" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl text-white font-bold text-lg" style="display:none; box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);">üíæ Salvar</button>
        <button id="btnDelete" class="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl text-white font-bold text-lg" style="box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);">üóëÔ∏è Excluir</button>
        <div class="flex gap-3 ml-auto flex-wrap">
          <button onclick="shareNote('whatsapp')" class="px-4 py-3 bg-green-600 hover:bg-green-700 rounded-xl text-white font-medium transition">WhatsApp</button>
          <button onclick="shareNote('telegram')" class="px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-white font-medium transition">Telegram</button>
          <button onclick="shareNote('email')" class="px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-xl text-white font-medium transition">Email</button>
          <button onclick="exportNote('txt')" class="px-4 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl text-white font-medium transition">TXT</button>
          <button onclick="exportNote('md')" class="px-4 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl text-white font-medium transition">MD</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Estado da aplica√ß√£o
let notes = [];
let currentNote = null;
let scene, camera, renderer, noteMeshes = [];
let animationFrame;
const colors = ['#ef4444','#f97316','#f59e0b','#eab308','#84cc16','#22c55e','#10b981','#14b8a6','#06b6d4','#0ea5e9','#3b82f6','#6366f1','#8b5cf6','#a855f7','#d946ef','#ec4899','#f43f5e','#64748b','#78716c','#a3a3a3'];

// Inicializa√ß√£o
setTimeout(() => {
  document.getElementById('splash').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  loadNotes();
  renderGrid();
}, 2500);

function loadNotes() {
  const stored = localStorage.getItem('meuUniversoX');
  if (stored) notes = JSON.parse(stored);
}

function saveNotes() {
  localStorage.setItem('meuUniversoX', JSON.stringify(notes));
}

function extractHashtags(text) {
  return text.match(/#[\w\u00C0-\u017F]+/g) || [];
}

function renderGrid() {
  const grid = document.getElementById('gridView');
  const search = document.getElementById('searchInput').value.toLowerCase();
  const filtered = notes.filter(n => 
    n.title.toLowerCase().includes(search) || 
    n.content.toLowerCase().includes(search)
  );
  
  grid.innerHTML = filtered.map(note => `
    <div class="note-card p-6 rounded-2xl cursor-pointer" 
         onclick="openNote(${note.id})">
      <h3 class="font-bold text-2xl mb-3 line-clamp-2 text-purple-900 handwriting">${note.title}</h3>
      <p class="text-base text-gray-700 line-clamp-4 leading-relaxed">${note.content}</p>
      <div class="mt-4 flex flex-wrap gap-2">
        ${extractHashtags(note.title + ' ' + note.content).map(tag => 
          `<span class="tag-neon text-sm px-3 py-1 rounded-full text-white font-semibold">${tag}</span>`
        ).join('')}
      </div>
    </div>
  `).join('');
}

function openNote(id) {
  currentNote = notes.find(n => n.id === id);
  if (!currentNote) return;
  
  document.getElementById('modalTitle').textContent = currentNote.title;
  document.getElementById('modalContent').textContent = currentNote.content;
  document.getElementById('modalTags').innerHTML = extractHashtags(currentNote.title + ' ' + currentNote.content)
    .map(tag => `<span class="tag-neon px-4 py-2 rounded-full text-white font-bold text-lg">${tag}</span>`).join('');
  
  document.getElementById('viewMode').style.display = 'block';
  document.getElementById('editMode').style.display = 'none';
  document.getElementById('btnEdit').style.display = 'block';
  document.getElementById('btnSave').style.display = 'none';
  document.getElementById('modal').style.display = 'flex';
}

// Event Listeners
document.getElementById('btnAdd').onclick = () => {
  const newNote = {
    id: Date.now(),
    title: 'Nova Nota ‚ú®',
    content: '',
    color: colors[Math.floor(Math.random() * colors.length)],
    created: new Date().toISOString()
  };
  notes.unshift(newNote);
  saveNotes();
  renderGrid();
  openNote(newNote.id);
  document.getElementById('btnEdit').click();
};

document.getElementById('btnGrid').onclick = () => {
  document.getElementById('gridView').style.display = 'grid';
  document.getElementById('graphView').style.display = 'none';
  document.getElementById('btnGrid').className = 'btn-neon p-3 rounded-xl text-white text-xl';
  document.getElementById('btnGraph').className = 'p-3 bg-purple-800/50 hover:bg-purple-700/70 rounded-xl text-white text-xl transition';
};

document.getElementById('btnGraph').onclick = () => {
  document.getElementById('gridView').style.display = 'none';
  document.getElementById('graphView').style.display = 'block';
  document.getElementById('btnGraph').className = 'btn-neon p-3 rounded-xl text-white text-xl';
  document.getElementById('btnGrid').className = 'p-3 bg-purple-800/50 hover:bg-purple-700/70 rounded-xl text-white text-xl transition';
  initThreeJS();
};

document.getElementById('btnEdit').onclick = () => {
  document.getElementById('editTitle').value = currentNote.title;
  document.getElementById('editContent').value = currentNote.content;
  document.getElementById('viewMode').style.display = 'none';
  document.getElementById('editMode').style.display = 'block';
  document.getElementById('btnEdit').style.display = 'none';
  document.getElementById('btnSave').style.display = 'block';
  
  const picker = document.getElementById('colorPicker');
  picker.innerHTML = colors.map(c => 
    `<button onclick="setColor('${c}')" class="w-10 h-10 rounded-full border-3 hover:scale-110 transition" style="background-color:${c}; box-shadow: 0 0 10px ${c};"></button>`
  ).join('');
};

document.getElementById('btnColorPicker').onclick = () => {
  const picker = document.getElementById('colorPicker');
  picker.style.display = picker.style.display === 'none' ? 'flex' : 'none';
};

function setColor(color) {
  currentNote.color = color;
}

document.getElementById('btnSave').onclick = () => {
  currentNote.title = document.getElementById('editTitle').value;
  currentNote.content = document.getElementById('editContent').value;
  saveNotes();
  renderGrid();
  openNote(currentNote.id);
};

document.getElementById('btnDelete').onclick = () => {
  if (confirm('üóëÔ∏è Excluir esta nota?')) {
    notes = notes.filter(n => n.id !== currentNote.id);
    saveNotes();
    renderGrid();
    document.getElementById('modal').style.display = 'none';
  }
};

document.getElementById('btnCloseModal').onclick = () => {
  document.getElementById('modal').style.display = 'none';
};

document.getElementById('searchInput').oninput = renderGrid;

document.getElementById('btnExport').onclick = () => {
  const data = JSON.stringify(notes, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'meu-universo-x-backup.json';
  a.click();
};

document.getElementById('importFile').onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const imported = JSON.parse(event.target.result);
        notes = [...imported, ...notes];
        saveNotes();
        renderGrid();
      } catch (err) {
        alert('Erro ao importar arquivo');
      }
    };
    reader.readAsText(file);
  }
};

function shareNote(platform) {
  const text = `${currentNote.title}\n\n${currentNote.content}`;
  const encoded = encodeURIComponent(text);
  const urls = {
    whatsapp: `https://wa.me/?text=${encoded}`,
    telegram: `https://t.me/share/url?text=${encoded}`,
    email: `mailto:?subject=${encodeURIComponent(currentNote.title)}&body=${encoded}`
  };
  window.open(urls[platform], '_blank');
}

function exportNote(format) {
  let content = '', filename = '';
  if (format === 'txt') {
    content = `${currentNote.title}\n\n${currentNote.content}`;
    filename = `${currentNote.title}.txt`;
  } else if (format === 'md') {
    content = `# ${currentNote.title}\n\n${currentNote.content}`;
    filename = `${currentNote.title}.md`;
  }
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
}

// Three.js
function initThreeJS() {
  if (scene) return;
  
  const canvas = document.getElementById('canvas3d');
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0a0a1f);
  
  camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
  camera.position.z = 30;
  
  renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  
  const particlesGeometry = new THREE.BufferGeometry();
  const positions = new Float32Array(5000);
  for (let i = 0; i < 5000; i++) positions[i] = (Math.random() - 0.5) * 100;
  particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  const particles = new THREE.Points(particlesGeometry, new THREE.PointsMaterial({ color: 0x8b5cf6, size: 0.15 }));
  scene.add(particles);
  
  const light = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(light);
  const pointLight = new THREE.PointLight(0x8b5cf6, 2);
  pointLight.position.set(0, 0, 20);
  scene.add(pointLight);
  
  canvas.onclick = onCanvasClick;
  updateGraph();
  animate();
}

function updateGraph() {
  if (!scene) return;
  
  noteMeshes.forEach(m => {
    scene.remove(m);
    if (m.geometry) m.geometry.dispose();
    if (m.material) m.material.dispose();
  });
  noteMeshes = [];
  
  const search = document.getElementById('searchInput').value.toLowerCase();
  const filtered = notes.filter(n => 
    n.title.toLowerCase().includes(search) || 
    n.content.toLowerCase().includes(search)
  );
  
  const hashtagMap = {};
  filtered.forEach(note => {
    const tags = extractHashtags(note.title + ' ' + note.content);
    tags.forEach(tag => {
      if (!hashtagMap[tag]) hashtagMap[tag] = [];
      hashtagMap[tag].push(note.id);
    });
  });
  
  const radius = 15;
  filtered.forEach((note, i) => {
    const angle = (i / filtered.length) * Math.PI * 2;
    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius;
    const z = (Math.random() - 0.5) * 10;
    
    const geometry = new THREE.SphereGeometry(1, 20, 20);
    const material = new THREE.MeshPhongMaterial({ 
      color: note.color,
      emissive: note.color,
      emissiveIntensity: 0.3,
      shininess: 100
    });
    const sphere = new THREE.Mesh(geometry, material);
    sphere.position.set(x, y, z);
    sphere.userData = { noteId: note.id, originalY: y };
    scene.add(sphere);
    noteMeshes.push(sphere);
  });
  
  Object.values(hashtagMap).forEach(noteIds => {
    if (noteIds.length > 1) {
      for (let i = 0; i < noteIds.length; i++) {
        for (let j = i + 1; j < noteIds.length; j++) {
          const m1 = noteMeshes.find(m => m.userData.noteId === noteIds[i]);
          const m2 = noteMeshes.find(m => m.userData.noteId === noteIds[j]);
          if (m1 && m2) {
            const points = [m1.position.clone(), m2.position.clone()];
            const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const lineMaterial = new THREE.LineBasicMaterial({ 
              color: 0x8b5cf6, 
              transparent: true, 
              opacity: 0.5,
              linewidth: 2
            });
            const line = new THREE.Line(lineGeometry, lineMaterial);
            line.userData = { mesh1: m1, mesh2: m2, isConnection: true };
            scene.add(line);
            noteMeshes.push(line);
          }
        }
      }
    }
  });
}

function animate() {
  animationFrame = requestAnimationFrame(animate);
  if (camera && scene) {
    camera.rotation.y += 0.001;
    noteMeshes.forEach(mesh => {
      if (mesh.geometry && mesh.geometry.type === 'SphereGeometry') {
        mesh.position.y = mesh.userData.originalY + Math.sin(Date.now() * 0.001 + mesh.position.x) * 0.4;
        mesh.rotation.y += 0.015;
        mesh.material.emissiveIntensity = 0.3 + Math.sin(Date.now() * 0.002) * 0.2;
      }
      if (mesh.userData && mesh.userData.isConnection) {
        const pos = mesh.geometry.attributes.position.array;
        pos[0] = mesh.userData.mesh1.position.x;
        pos[1] = mesh.userData.mesh1.position.y;
        pos[2] = mesh.userData.mesh1.position.z;
        pos[3] = mesh.userData.mesh2.position.x;
        pos[4] = mesh.userData.mesh2.position.y;
        pos[5] = mesh.userData.mesh2.position.z;
        mesh.geometry.attributes.position.needsUpdate = true;
      }
    });
    renderer?.render(scene, camera);
  }
}

function onCanvasClick(e) {
  if (!camera || !scene) return;
  const canvas = document.getElementById('canvas3d');
  const
