<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Meu Universo X ‚Äî Shinobi Tech</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#071026;
    --accent:#00d4ff;
    --muted:rgba(255,255,255,0.12);
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,Arial,sans-serif;color:#fff;overflow:hidden}
  /* ------------------ Pergaminho de abertura ------------------ */
  #scroll-screen{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background: linear-gradient(180deg,#070911 0%, #07102a 60%);
    z-index:9999;
  }
  .scroll-wrap{width:92%;max-width:700px;transform-origin:top;animation:unroll 2.6s cubic-bezier(.2,.9,.3,1) forwards}
  @keyframes unroll{0%{transform:scaleY(0);opacity:0}60%{transform:scaleY(1.05);opacity:1}100%{transform:scaleY(1)}}
  .scroll-top,.scroll-bottom{height:48px;background:linear-gradient(90deg,#5a2f08,#a8652f,#5a2f08);border-radius:28px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
  .scroll-paper{background:linear-gradient(180deg,#f2e5c8,#e6d4aa);padding:64px 36px;min-height:320px;text-align:center;box-shadow:inset 0 0 30px rgba(0,0,0,.1);position:relative;overflow:hidden}
  .seal{width:120px;height:120px;border-radius:50%;margin:0 auto 18px;display:flex;align-items:center;justify-content:center;
        background:radial-gradient(circle,#d93b3b,#7f0000);box-shadow:0 12px 30px rgba(217,59,59,.18);animation:spin 3.6s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .seal .char{font-size:44px;font-weight:800;letter-spacing:1px}
  .title{font-family:Georgia,serif;font-size:42px;color:#7a451b;margin-top:6px;opacity:0;transform:translateY(18px);animation:titleIn 1.1s ease-out 1.4s forwards}
  @keyframes titleIn{to{opacity:1;transform:none}}
  /* fade out */
  .fade-out{animation:fadeOut 0.9s ease forwards}
  @keyframes fadeOut{to{opacity:0;visibility:hidden;transform:translateY(-8px)}}

  /* ------------------ Login ------------------ */
  #login-screen{display:none;height:100vh;align-items:center;justify-content:center;padding:20px}
  .login-card{width:100%;max-width:380px;padding:28px;border-radius:12px;background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.02));border:1px solid var(--muted);backdrop-filter:blur(6px);box-shadow:0 20px 60px rgba(0,0,0,.6);text-align:center}
  .login-card h2{color:var(--accent);margin:0 0 12px;font-size:20px}
  .login-card p{margin:0 0 18px;color:rgba(255,255,255,.7);font-size:13px}
  .input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:#fff;margin-bottom:12px;outline:none}
  .btn{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#0099cc);color:#021;cursor:pointer;font-weight:700}
  .link{display:inline-block;margin-top:12px;color:rgba(255,255,255,.7);font-size:13px;cursor:pointer}
  .err{color:#ff6b6b;margin-top:8px;display:none;font-size:13px}

  /* ------------------ App principal (Shinobi Tech) ------------------ */
  #app{display:none;height:100vh;overflow:hidden}
  .topbar{height:72px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:linear-gradient(90deg,rgba(0,0,0,.2),transparent);border-bottom:1px solid rgba(0,212,255,0.06)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:46px;height:46;border-radius:10px;background:linear-gradient(135deg,#021428,#002b42);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent);box-shadow:0 6px 24px rgba(0,212,255,.06)}
  .apptitle{font-size:18px;color:var(--accent);font-weight:700}
  .top-actions{display:flex;gap:10px;align-items:center}

  .container{display:flex;height:calc(100vh - 72px);overflow:hidden}
  .sidebar{width:260px;padding:22px;background:linear-gradient(180deg,rgba(0,0,0,0.18),rgba(0,0,0,0.06));border-right:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(6px)}
  .side-section{margin-bottom:18px}
  .side-title{font-size:12px;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
  .menu-item{padding:10px 12px;border-radius:8px;color:rgba(255,255,255,.8);cursor:pointer;margin-bottom:8px}
  .menu-item.active{background:linear-gradient(90deg,rgba(0,212,255,0.08),transparent);color:var(--accent);font-weight:700}

  .main{flex:1;padding:22px;overflow:auto;background:linear-gradient(180deg,#071026 0%, #041122 100%)}
  .controls{display:flex;gap:12px;align-items:center;margin-bottom:18px}
  .search{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
  .note{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;min-height:110px;display:flex;flex-direction:column;gap:8px}
  .note h4{margin:0;font-size:15px;color:var(--accent)}
  .note p{margin:0;color:rgba(255,255,255,.78);font-size:13px;white-space:pre-wrap;flex:1}
  .note .meta{display:flex;justify-content:space-between;color:rgba(255,255,255,.45);font-size:12px}

  .floating{position:fixed;right:28px;bottom:28px;width:56px;height:56px;border-radius:50%;background:linear-gradient(90deg,var(--accent),#0099cc);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021;box-shadow:0 12px 40px rgba(0,212,255,0.12);cursor:pointer}

  /* modal (editor/settings) */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.6));z-index:1200}
  .modal-card{width:100%;max-width:720px;background:linear-gradient(180deg,#071026,#081430);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .row{display:flex;gap:12px}
  textarea.input{min-height:140px;resize:vertical;padding:12px}
  .small{font-size:13px;color:rgba(255,255,255,.7)}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}

  @media(max-width:860px){
    .sidebar{display:none}
    .grid{grid-template-columns:1fr}
  }

</style>
</head>
<body>

<!-- ---------- Pergaminho ---------- -->
<div id="scroll-screen" aria-hidden="true">
  <div class="scroll-wrap" role="img" aria-label="Pergaminho abrindo">
    <div class="scroll-top"></div>
    <div class="scroll-paper">
      <div class="seal"><div class="char">Â∞Å</div></div>
      <div class="title">MEU UNIVERSO X</div>
    </div>
    <div class="scroll-bottom"></div>
  </div>
</div>

<!-- ---------- LOGIN ---------- -->
<div id="login-screen">
  <div class="login-card" role="dialog" aria-label="Painel de login">
    <h2>üîí Meu Universo X</h2>
    <p id="login-sub">Insere a senha para entrar ‚Äî ou define uma nova senha.</p>
    <input id="pwd" class="input" type="password" placeholder="Senha" autocomplete="off" />
    <button id="btnLogin" class="btn">Entrar</button>

    <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
      <span class="link" id="setPwd">Definir / Alterar senha</span>
      <span class="link" id="forgot">Esqueci (apagar dados)</span>
    </div>

    <div class="err" id="errLogin">Senha incorreta</div>
  </div>
</div>

<!-- ---------- APP ---------- -->
<div id="app" aria-hidden="true">
  <div class="topbar">
    <div class="brand">
      <div class="logo">MX</div>
      <div>
        <div class="apptitle">Meu Universo X</div>
        <div style="font-size:12px;color:rgba(255,255,255,.45)">Shinobi Tech ‚Ä¢ Notas</div>
      </div>
    </div>
    <div class="top-actions">
      <input id="search" class="search" placeholder="Procurar notas..." />
      <button class="btn-ghost" id="openSettings">‚öôÔ∏è</button>
      <button class="btn-ghost" id="logoutBtn">üö™ Sair</button>
    </div>
  </div>

  <div class="container">
    <aside class="sidebar" aria-label="Menu lateral">
      <div class="side-section">
        <div class="side-title">Notas</div>
        <div class="menu-item active" data-tab="all">Todas</div>
        <div class="menu-item" data-tab="fav">Favoritas</div>
        <div class="menu-item" data-tab="arch">Arquivadas</div>
      </div>

      <div class="side-section">
        <div class="side-title">Tags</div>
        <div class="menu-item" id="tag-todos">#todos</div>
      </div>

      <div style="flex:1"></div>
      <div style="font-size:12px;color:rgba(255,255,255,.45)">LocalStorage ‚Ä¢ Offline</div>
    </aside>

    <main class="main" id="main">
      <div class="controls">
        <button class="btn-ghost" id="newNote">+ Nova Nota</button>
        <div style="flex:1"></div>
        <div class="small">Notas: <span id="count">0</span></div>
      </div>

      <div class="grid" id="grid"></div>
    </main>
  </div>

  <div class="floating" id="fab">+</div>
</div>

<!-- ---------- MODAL: editor / settings ---------- -->
<div class="modal" id="modal">
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:700">Editor de Nota</div>
      <div><button class="btn-ghost" id="closeModal">Fechar</button></div>
    </div>

    <input id="noteTitle" class="input" placeholder="T√≠tulo da nota" />
    <textarea id="noteContent" class="input" placeholder="Escreve a nota..."></textarea>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn" id="saveNote">Salvar</button>
      <button class="btn-ghost" id="toggleFav">‚≠ê Favorita</button>
      <button class="btn-ghost" id="archiveNote">üì¶ Arquivar</button>
      <div style="flex:1"></div>
      <button class="btn-ghost" id="delNote" style="color:#ff6b6b">Apagar</button>
    </div>
  </div>
</div>

<!-- ---------- MODAL: settings password ---------- -->
<div class="modal" id="modal-settings" aria-hidden="true">
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:700">Configura√ß√µes</div>
      <div><button class="btn-ghost" id="closeSettings">Fechar</button></div>
    </div>

    <div style="margin-bottom:8px" class="small">Definir/Alterar senha (guardada localmente)</div>
    <input id="newPwd" class="input" type="password" placeholder="Nova senha" />
    <input id="newPwdConfirm" class="input" type="password" placeholder="Confirmar nova senha" />
    <div style="display:flex;gap:8px">
      <button class="btn" id="savePwd">Salvar senha</button>
      <button class="btn-ghost" id="clearAll" style="color:#ff6b6b">Apagar tudo</button>
      <div style="flex:1"></div>
      <div class="small" id="pwdMsg"></div>
    </div>
  </div>
</div>

<script>
/* ---------- Util / armazenamento ---------- */
const LS_KEY = 'mx_user_data_v1';
function loadState(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return {password:null,notes:[]};
  try{ return JSON.parse(raw) }catch(e){ return {password:null,notes:[]} }
}
function saveState(state){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

let state = loadState();

/* ---------- Pergaminho -> login transition ---------- */
const scrollScreen = document.getElementById('scroll-screen');
const loginScreen = document.getElementById('login-screen');
const app = document.getElementById('app');

setTimeout(()=>{
  // esconde o pergaminho com suavidade e mostra login
  scrollScreen.classList.add('fade-out');
  setTimeout(()=>{
    scrollScreen.style.display='none';
    showLogin();
  },900);
},3400);

function showLogin(){
  loginScreen.style.display='flex';
  document.getElementById('pwd').focus();
  updateLoginSubtitle();
}

function updateLoginSubtitle(){
  const sub = document.getElementById('login-sub');
  sub.textContent = state.password ? 'Insere a senha para entrar.' : 'Sem senha definida ‚Äî cria uma agora.';
}

/* ---------- Login / senha ---------- */
document.getElementById('btnLogin').addEventListener('click', attemptLogin);
document.getElementById('pwd').addEventListener('keypress', e=>{ if(e.key==='Enter') attemptLogin() });

function attemptLogin(){
  const input = document.getElementById('pwd').value;
  const err = document.getElementById('errLogin');
  if(!state.password){
    // se n√£o existe senha, pro√≠be entrar sem definir
    err.textContent = 'Nenhuma senha definida. Usa "Definir / Alterar senha".'; err.style.display='block';
    setTimeout(()=>err.style.display='none',1800);
    return;
  }
  if(input === state.password){
    // sucesso
    loginScreen.style.display='none';
    startApp();
    document.getElementById('pwd').value='';
  } else {
    err.textContent = 'Senha incorreta'; err.style.display='block';
    setTimeout(()=>err.style.display='none',1500);
  }
}

// Definir / alterar senha
document.getElementById('setPwd').addEventListener('click', ()=> openSettings());
document.getElementById('openSettings').addEventListener('click', ()=> openSettings());
document.getElementById('forgot').addEventListener('click', ()=>{
  if(confirm('Apagar todos os dados locais (inclui senha e notas)?')){
    localStorage.removeItem(LS_KEY);
    state = {password:null,notes:[]};
    alert('Dados apagados. Define uma nova senha nas configura√ß√µes.');
    updateLoginSubtitle();
  }
});

document.getElementById('savePwd').addEventListener('click', ()=>{
  const a = document.getElementById('newPwd').value;
  const b = document.getElementById('newPwdConfirm').value;
  const msg = document.getElementById('pwdMsg');
  if(!a){ msg.textContent='Senha vazia'; msg.style.color='#ff6b6b'; return; }
  if(a !== b){ msg.textContent='As senhas n√£o coincidem'; msg.style.color='#ff6b6b'; return; }
  state.password = a;
  saveState(state);
  msg.textContent = 'Senha salva'; msg.style.color='#8ef'; setTimeout(()=>{ msg.textContent=''; closeSettings() },1000);
  updateLoginSubtitle();
});

/* ---------- App flow ---------- */
function startApp(){
  app.style.display='block';
  state = loadState();
  renderNotes();
}

document.getElementById('logoutBtn').addEventListener('click', ()=>{
  if(confirm('Deseja sair?')){ app.style.display='none'; loginScreen.style.display='flex'; }
});

/* ---------- Notas: CRUD ---------- */
const grid = document.getElementById('grid');
const countEl = document.getElementById('count');

function renderNotes(filter='all',query=''){
  grid.innerHTML='';
  const notes = state.notes || [];
  let visible = notes.slice().reverse(); // newest first
  if(filter==='fav') visible = visible.filter(n=>n.fav);
  if(filter==='arch') visible = visible.filter(n=>n.archived);
  if(query) visible = visible.filter(n => (n.title+n.content).toLowerCase().includes(query.toLowerCase()));
  visible.forEach(n=>{
    const el = document.createElement('div'); el.className='note';
    el.innerHTML = `<h4>${escapeHtml(n.title || 'Sem t√≠tulo')}</h4>
      <p>${escapeHtml(n.content || '')}</p>
      <div class="meta"><span>${new Date(n.created).toLocaleString()}</span><span>${n.fav? '‚≠ê':''}${n.archived? ' ‚Ä¢ arquivada':''}</span></div>`;
    el.addEventListener('click', ()=> openEditor(n.id));
    grid.appendChild(el);
  });
  countEl.textContent = notes.length;
}

/* helpers */
function escapeHtml(s = '') { return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

/* new note */
document.getElementById('newNote').addEventListener('click', ()=> openEditor());
document.getElementById('fab').addEventListener('click', ()=> openEditor());

let currentEditId = null;
const modal = document.getElementById('modal');
const noteTitle = document.getElementById('noteTitle');
const noteContent = document.getElementById('noteContent');

function openEditor(id){
  currentEditId = id || null;
  if(id){
    const n = (state.notes || []).find(x=>x.id===id);
    if(n){ noteTitle.value = n.title; noteContent.value = n.content; }
  } else { noteTitle.value=''; noteContent.value=''; }
  modal.style.display='flex';
}

document.getElementById('closeModal').addEventListener('click', ()=> { modal.style.display='none' });

document.getElementById('saveNote').addEventListener('click', ()=>{
  const title = noteTitle.value.trim();
  const content = noteContent.value.trim();
  if(currentEditId){
    const idx = state.notes.findIndex(n=>n.id===currentEditId);
    if(idx>-1){ state.notes[idx].title = title; state.notes[idx].content = content; state.notes[idx].updated = Date.now(); }
  } else {
    const note = { id: Date.now(), title, content, created: Date.now(), updated:Date.now(), fav:false, archived:false };
    state.notes = state.notes || []; state.notes.push(note);
  }
  saveState(state);
  modal.style.display='none';
  renderNotes(getActiveTab(), document.getElementById('search').value);
});

document.getElementById('delNote').addEventListener('click', ()=>{
  if(!currentEditId) return;
  if(confirm('Apagar esta nota?')){
    state.notes = state.notes.filter(n=>n.id !== currentEditId);
    saveState(state);
    modal.style.display='none';
    renderNotes(getActiveTab(), document.getElementById('search').value);
  }
});

document.getElementById('toggleFav').addEventListener('click', ()=>{
  if(!currentEditId) return;
  const n = state.notes.find(x=>x.id===currentEditId);
  if(n){ n.fav = !n.fav; saveState(state); renderNotes(getActiveTab(), document.getElementById('search').value); }
});

document.getElementById('archiveNote').addEventListener('click', ()=>{
  if(!currentEditId) return;
  const n = state.notes.find(x=>x.id===currentEditId);
  if(n){ n.archived = !n.archived; saveState(state); renderNotes(getActiveTab(), document.getElementById('search').value); }
});

/* search */
document.getElementById('search').addEventListener('input', (e)=>{
  renderNotes(getActiveTab(), e.target.value);
});

/* sidebar menu */
document.querySelectorAll('.menu-item').forEach((el)=>{
  el.addEventListener('click', ()=>{
    document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
    el.classList.add('active');
    renderNotes(getActiveTab(), document.getElementById('search').value);
  });
});

function getActiveTab(){
  const active = document.querySelector('.menu-item.active');
  if(!active) return 'all';
  if(active.dataset.tab) return active.dataset.tab;
  return 'all';
}

/* ---------- Settings modal ---------- */
const modalSettings = document.getElementById('modal-settings');
document.getElementById('openSettings').addEventListener('click', openSettings);
document.getElementById('closeSettings').addEventListener('click', closeSettings);
function openSettings(){ modalSettings.style.display='flex'; document.getElementById('newPwd').value=''; document.getElementById('newPwdConfirm').value=''; document.getElementById('pwdMsg').textContent=''; }
function closeSettings(){ modalSettings.style.display='none'; }

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(confirm('Apagar tudo (senha + notas)?')){
    localStorage.removeItem(LS_KEY);
    state = {password:null,notes:[]};
    saveState(state);
    closeSettings();
    alert('Apagado. Ir√° precisar definir nova senha.');
    updateLoginSubtitle();
    modalSettings.style.display='none';
  }
});

/* ---------- save password button wired earlier ---------- */
document.getElementById('savePwd').addEventListener('click', ()=>{}); // placeholder wired above

/* ensure savePwd works: reattach to element (for some browsers) */
document.getElementById('savePwd').onclick = function(){
  const a = document.getElementById('newPwd').value;
  const b = document.getElementById('newPwdConfirm').value;
  const msg = document.getElementById('pwdMsg');
  if(!a){ msg.textContent='Senha vazia'; msg.style.color='#ff6b6b'; return; }
  if(a !== b){ msg.textContent='As senhas n√£o coincidem'; msg.style.color='#ff6b6b'; return; }
  state.password = a;
  saveState(state);
  msg.textContent = 'Senha salva'; msg.style.color='#8ef';
  setTimeout(()=>{ msg.textContent=''; closeSettings(); updateLoginSubtitle() },900);
};

/* close modal by clicking outside */
[modal, modalSettings].forEach(m => m.addEventListener('click', e => { if(e.target === m) m.style.display='none' }));

/* initial render if already logged in (for dev) */
if(location.hash === '#dev-autologin'){ if(state.password){ loginScreen.style.display='none'; startApp(); } }

/* small safety: prevent accidental text selection for seal */
document.querySelectorAll('.seal, .title').forEach(el => el.style.userSelect='none');

</script>
</body>
</html>
