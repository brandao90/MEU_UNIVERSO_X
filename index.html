<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Meu Universo X ‚Äî Notas</title>
<style>
/* ===== RESET / BASE ===== */
:root{
  --bg1:#081126; --paper1:#f5e6d3; --accent1:#667eea; --accent2:#764ba2;
  --card-shadow: 0 10px 40px rgba(2,8,23,0.45);
  --note-pad: #fffdf2;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial;
  background: linear-gradient(180deg,#081a2a,#071424 60%);
  color:#111827; -webkit-font-smoothing:antialiased;
  min-height:100vh; overflow:hidden;
}

/* APP LAYOUT */
#app{ position:relative; min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:26px; }

/* --- INTRO (PERGAMINHO) --- */
#scroll-animation{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9999; pointer-events:none; background: radial-gradient(circle at 50% 10%, rgba(255,255,255,0.02), transparent 10%); }
.scroll-wrapper{ width:560px; max-width:88vw; position:relative; display:flex; flex-direction:column; align-items:center; transform-origin:center top; animation:fallIn 1.8s cubic-bezier(.22,.9,.35,1) forwards;}
@keyframes fallIn{0%{transform:translateY(-160vh) rotate(-18deg); opacity:0} 55%{transform:translateY(-6vh) rotate(-3deg); opacity:1} 72%{transform:translateY(0) rotate(0deg)} 100%{transform:translateY(0) rotate(0deg)}}
.wood-roll{ width:100%; height:64px; border-radius:36px; background: linear-gradient(90deg,#4e2f2a,#6b4a3f,#8b6b60,#6b4a3f,#4e2f2a); box-shadow:0 10px 30px rgba(0,0,0,0.45), inset 0 3px 8px rgba(255,255,255,0.12); position:relative; z-index:3 }
.scroll-paper{ width:100%; height:0; background: linear-gradient(135deg,var(--paper1), #efe0c8 60%); box-shadow: inset 0 0 40px rgba(0,0,0,0.08), 0 10px 30px rgba(0,0,0,0.35); overflow:hidden; position:relative; z-index:2; border-left:6px solid rgba(139,115,85,0.18); border-right:6px solid rgba(139,115,85,0.18); animation:unroll 4.6s cubic-bezier(.2,.9,.25,1) 1s forwards; }
@keyframes unroll{0%{height:0} 60%{height:340px} 100%{height:420px}}
.scroll-paper::before{ content:""; position:absolute; inset:0; background-image: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(139,115,85,0.02) 3px, rgba(139,115,85,0.02) 6px), repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(139,115,85,0.02) 3px, rgba(139,115,85,0.02) 6px); pointer-events:none; mix-blend-mode:multiply; }
.scroll-content{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; opacity:0; transform:translateY(10px); animation:contentIn 1s ease 5.0s forwards;}
@keyframes contentIn{0%{opacity:0; transform:translateY(24px)} 100%{opacity:1; transform:translateY(0)}}
.seal{ width:120px;height:120px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 30% 25%, #ff6b6b,#c62828 60%, #8b1515 100%); box-shadow:0 8px 30px rgba(0,0,0,0.4), inset 0 3px 8px rgba(255,255,255,0.18); transform:scale(0.0) rotate(0); opacity:0; animation:sealPop .7s cubic-bezier(.2,.95,.2,1.05) 4.6s forwards, sealRotate 9s linear 5.4s infinite; }
@keyframes sealPop{0%{transform:scale(0); opacity:0} 60%{transform:scale(1.25); opacity:1} 100%{transform:scale(1)}}
@keyframes sealRotate{0%{transform:scale(1) rotate(0deg)} 100%{transform:scale(1) rotate(360deg)}}
.kanji{ font-size:64px;color:#fdeedc;font-weight:800; text-shadow:2px 2px 6px rgba(0,0,0,0.45) }
.scroll-title{ margin-top:18px; font-family:'Courier New', monospace; font-size:42px; font-weight:800; letter-spacing:4px; color:#24120b; opacity:0; transform:translateY(8px); animation:titleIn .9s ease 5.2s forwards; text-shadow:0 6px 18px rgba(255,215,0,0.08) }
@keyframes titleIn{ to{opacity:1; transform:translateY(0)} }
#scroll-animation.fadeout{ animation:scrollFade 1.0s ease 6.6s forwards; }
@keyframes scrollFade{0%{opacity:1}100%{opacity:0; visibility:hidden}}

/* --- LOGIN --- */
#login-screen{ position:relative; z-index:50; width:100%; max-width:520px; opacity:0; transform:translateY(12px) scale(.99); transition:all .55s ease; margin-top:24px; }
#login-screen.visible{ opacity:1; transform:translateY(0) scale(1) }
.login-card{ background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,250,0.95)); border-radius:22px; padding:20px; box-shadow:var(--card-shadow); display:flex; flex-direction:column; gap:10px; }
.login-title{ text-align:center; font-size:24px; font-weight:800; display:flex; gap:8px; align-items:center; justify-content:center }
.login-sub{ text-align:center; color:#56616b; font-size:13px }
.field{ display:flex; flex-direction:column; gap:6px; margin-top:6px }
label{ font-size:13px; font-weight:700; color:#23303b }
input[type="password"]{ padding:12px;border-radius:10px;border:2px solid #e6e6e6; font-size:15px; outline:none; transition:all .18s ease; }
input[type="password"]:focus{ border-color:#6e8de8; box-shadow:0 6px 18px rgba(102,126,234,0.12) }
.btn{ margin-top:6px;padding:12px;border-radius:12px;border:none;cursor:pointer; background:linear-gradient(135deg,var(--accent1),var(--accent2)); color:#fff; font-weight:800; font-size:16px; box-shadow:0 10px 30px rgba(102,126,234,0.18); }
.hint{ text-align:center; color:#8a97a6; font-size:13px; margin-top:6px }
.error{ background:#fee;padding:10px;border-radius:10px;border-left:4px solid #c33;color:#8a1b1b; display:none; }

/* --- NOTES APP --- */
#notes-app{ display:none; position:relative; z-index:40; width:100%; max-width:1100px; margin:18px auto 36px; }
#notes-app.active{ display:block; }

.topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px; }
.brand{ display:flex; align-items:center; gap:12px; }
.logo{ width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2)); color:#fff;font-weight:900;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:var(--card-shadow) }
.brand h2{ font-size:18px; font-weight:800 }
.controls{ display:flex; gap:10px; align-items:center; }

.search{ padding:10px 12px;border-radius:12px;border:2px solid #e6e6e6; width:220px; outline:none }
.create-note{ padding:10px 14px;border-radius:12px;border:2px dashed rgba(0,0,0,0.06); background:linear-gradient(180deg,#fff,#fbfbfb); display:flex; gap:10px; align-items:center; cursor:pointer; min-width:220px }

.actions-row{ display:flex; gap:8px; align-items:center }

/* GRID */
.grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(230px,1fr)); gap:16px; }

/* CARD */
.note{ background:#fff; border-radius:12px; padding:12px; min-height:120px; position:relative; box-shadow:0 8px 30px rgba(2,8,23,.08); display:flex; flex-direction:column; gap:8px; }
.note .title{ font-weight:800; font-size:15px; outline:none }
.note .content{ font-size:14px; color:#1f2937; flex:1; outline:none; white-space:pre-wrap; overflow:auto; }
.note-footer{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:8px }
.note-actions{ display:flex; gap:8px; align-items:center }

/* colors */
.clr-0{ background:#fff }
.clr-1{ background:#fff7c0 }
.clr-2{ background:#ffd6b6 }
.clr-3{ background:#fddaf6 }
.clr-4{ background:#d7facc }

/* small screen tweaks */
@media (max-width:680px){
  .scroll-wrapper{ width:92vw }
  .controls .search{ width:120px }
  .brand h2{ display:none }
}
</style>
</head>
<body>
  <div id="app">
    <!-- PERGAMINHO -->
    <div id="scroll-animation" aria-hidden="true">
      <div class="scroll-wrapper" role="img" aria-label="Pergaminho de abertura">
        <div class="wood-roll top" style="transform:translateY(8px)"></div>
        <div class="scroll-paper" aria-hidden="true">
          <div class="scroll-content">
            <div class="seal"><div class="kanji">Â∞Å</div></div>
            <div class="scroll-title">MEU UNIVERSO X</div>
          </div>
        </div>
        <div class="wood-roll bottom" style="transform:translateY(-8px)"></div>
      </div>
    </div>

    <!-- LOGIN -->
    <div id="login-screen" aria-labelledby="login-title">
      <div class="login-card">
        <div class="login-title" id="login-title">üîê Acesso Seguro ‚Äî Meu Universo X</div>
        <div class="login-sub">Digite a senha para abrir o aplicativo</div>
        <div id="login-error" class="error">Senha incorreta</div>
        <div class="field">
          <label for="password">Senha</label>
          <input id="password" type="password" inputmode="text" autocomplete="off" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
        <button id="login-btn" class="btn">Entrar</button>
        <div class="hint">Dica: senha padr√£o no c√≥digo. Muda quando quiser.</div>
      </div>
    </div>

    <!-- NOTES APP -->
    <main id="notes-app" aria-live="polite">
      <div class="topbar">
        <div class="brand">
          <div class="logo">X</div>
          <div>
            <h2>Meu Universo X</h2>
            <div style="color:#6b7280;font-size:13px">Bloco de notas ‚Äî estilo Keep ‚Ä¢ Offline</div>
          </div>
        </div>

        <div class="controls">
          <input id="search" class="search" placeholder="Pesquisar notas..." />
          <div id="create" class="create-note" title="Criar nova nota">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.9">
              <path d="M12 5v14M5 12h14" stroke="#374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div style="font-weight:700;color:#374151">Nova nota</div>
          </div>

          <!-- export / import / drive -->
          <div class="actions-row" style="margin-left:6px">
            <button id="exportAllBtn" class="btn" title="Exportar todas as notas (JSON)">Exportar JSON</button>
            <label style="display:inline-block;margin-left:6px">
              <input id="importFile" type="file" accept="application/json" style="display:none"/>
              <button class="btn" onclick="document.getElementById('importFile').click()" title="Importar JSON">Importar JSON</button>
            </label>
          </div>
        </div>
      </div>

      <!-- drive quick uploader (opcional token) -->
      <div style="margin-bottom:14px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;max-width:1100px">
        <div style="background:#fff;padding:10px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06);font-size:13px;color:#334155">
          <strong>Guardar no Google Drive:</strong>
          <div style="max-width:820px; font-size:13px; color:#6b7280; margin-top:6px">
            Para upload direto: cole um <strong>Access Token</strong> (OAuth2) gerado por ti no campo, depois clica em "Upload JSON para Drive".
            <br><small>Se n√£o souberes como obter um token, exporta o JSON e carrega manualmente no Google Drive ‚Äî √© mais seguro.</small>
          </div>
        </div>

        <input id="driveToken" placeholder="Cole aqui o Access Token (opcional)" style="min-width:320px;padding:10px;border-radius:10px;border:1px solid #e6e6e6" />
        <button id="uploadDriveBtn" class="btn">Upload JSON para Drive</button>
        <button id="downloadAllBtn" class="btn" style="background:linear-gradient(135deg,#22c1c3,#2e9fff)">Download JSON</button>
      </div>

      <section id="notes-grid" class="grid" aria-label="Notas"></section>
    </main>

  </div>

<script>
/* ================= CONFIG ================= */
const PASSWORD = 'meuuniversox'; // altera aqui se quiseres
const STORAGE_KEY = 'meuuniversox_notes_v1';
const COLORS = ['clr-0','clr-1','clr-2','clr-3','clr-4'];

/* ===== ELEMENTS ===== */
const scrollAnim = document.getElementById('scroll-animation');
const loginScreen = document.getElementById('login-screen');
const loginBtn = document.getElementById('login-btn');
const passwordInput = document.getElementById('password');
const loginError = document.getElementById('login-error');
const notesApp = document.getElementById('notes-app');
const createBtn = document.getElementById('create');
const notesGrid = document.getElementById('notes-grid');
const searchInput = document.getElementById('search');
const exportAllBtn = document.getElementById('exportAllBtn');
const importFile = document.getElementById('importFile');
const downloadAllBtn = document.getElementById('downloadAllBtn');
const driveTokenInput = document.getElementById('driveToken');
const uploadDriveBtn = document.getElementById('uploadDriveBtn');

let NOTES = [];

/* ========== INTRO TIMING ========== */
/* start fadeout of scroll so intro feels ~10s in total */
setTimeout(()=> {
  scrollAnim.classList.add('fadeout');
  setTimeout(()=> loginScreen.classList.add('visible'), 700);
}, 6200);
setTimeout(()=> passwordInput.focus(), 7000);

/* ===== LOGIN ===== */
function showError(msg){ loginError.textContent = msg || 'Senha incorreta'; loginError.style.display = 'block'; setTimeout(()=> loginError.style.display = 'none', 2000); }
loginBtn.addEventListener('click', tryLogin);
passwordInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') tryLogin(); });

function tryLogin(){
  const val = (passwordInput.value || '').trim();
  if(val === PASSWORD){
    loginScreen.style.transition = 'all .4s ease';
    loginScreen.style.opacity = '0';
    loginScreen.style.transform = 'translateY(8px) scale(.98)';
    setTimeout(()=> { loginScreen.style.display = 'none'; openNotesApp(); }, 450);
  } else {
    showError('Senha incorreta');
    passwordInput.value = ''; passwordInput.focus();
  }
}

/* ===== NOTES STORE ===== */
function loadNotes(){
  try{ const raw = localStorage.getItem(STORAGE_KEY); NOTES = raw ? JSON.parse(raw) : []; } catch(e){ NOTES = [] }
}
function saveNotes(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(NOTES)); }

/* create new note */
function createNote(initial = {title:'', content:'', color:COLORS[0]}){
  const note = { id: 'n_' + Date.now() + '_' + Math.floor(Math.random()*9999), title: initial.title || '', content: initial.content || '', color: initial.color || COLORS[0], updated: Date.now() };
  NOTES.unshift(note);
  saveNotes();
  renderNotes();
  setTimeout(()=> { const el = document.querySelector(`[data-id="${note.id}"]`); if(el){ el.querySelector('.title').focus(); placeCaretAtEnd(el.querySelector('.title')); } }, 120);
}

/* render notes */
function renderNotes(filter=''){
  notesGrid.innerHTML = '';
  const q = (filter||'').toLowerCase().trim();
  NOTES.forEach(note => {
    if(q){ const t = (note.title||'') + ' ' + (note.content||''); if(!t.toLowerCase().includes(q)) return; }
    const card = document.createElement('article');
    card.className = 'note ' + note.color;
    card.dataset.id = note.id;
    card.innerHTML = `
      <div contenteditable="true" class="title" aria-label="T√≠tulo">${escapeHtml(note.title)}</div>
      <div contenteditable="true" class="content" aria-label="Conte√∫do">${escapeHtml(note.content)}</div>
      <div class="note-footer">
        <div style="font-size:12px;color:#6b7280">Atualizada ${timeAgo(note.updated)}</div>
        <div class="note-actions">
          <select class="color-select" title="Cor">
            <option value="clr-0">Branco</option>
            <option value="clr-1">Amarelo</option>
            <option value="clr-2">Laranja</option>
            <option value="clr-3">Rosa</option>
            <option value="clr-4">Verde</option>
          </select>
          <button class="icon-btn btn-share-email" title="Partilhar por Email" aria-label="Partilhar por Email">
            ‚úâÔ∏è
          </button>
          <button class="icon-btn btn-share-ws" title="Partilhar por WhatsApp" aria-label="Partilhar por WhatsApp">
            üí¨
          </button>
          <button class="icon-btn btn-download-txt" title="Descarregar nota" aria-label="Descarregar nota">‚¨áÔ∏è</button>
          <button class="icon-btn btn-export-json" title="Exportar nota (JSON)">üì§</button>
          <button class="icon-btn btn-delete" title="Excluir">üóëÔ∏è</button>
        </div>
      </div>
    `;
    const select = card.querySelector('.color-select');
    select.value = note.color;
    const titleEl = card.querySelector('.title');
    const contentEl = card.querySelector('.content');
    const deleteBtn = card.querySelector('.btn-delete');
    const emailBtn = card.querySelector('.btn-share-email');
    const wsBtn = card.querySelector('.btn-share-ws');
    const dlBtn = card.querySelector('.btn-download-txt');
    const exportJsonBtn = card.querySelector('.btn-export-json');

    titleEl.addEventListener('input', ()=> debounceSave(note.id, titleEl, contentEl, select));
    contentEl.addEventListener('input', ()=> debounceSave(note.id, titleEl, contentEl, select));
    select.addEventListener('change', ()=> { note.color = select.value; note.updated = Date.now(); saveNotes(); renderNotes(searchInput.value); });

    deleteBtn.addEventListener('click', ()=> { if(confirm('Excluir nota?')){ NOTES = NOTES.filter(n=>n.id !== note.id); saveNotes(); renderNotes(searchInput.value); }});

    emailBtn.addEventListener('click', ()=> {
      const subject = encodeURIComponent(note.title || 'Nota - Meu Universo X');
      const body = encodeURIComponent((note.title? note.title + '\n\n':'') + note.content);
      // mailto with body (may be long)
      const url = `mailto:?subject=${subject}&body=${body}`;
      window.location.href = url;
    });

    wsBtn.addEventListener('click', ()=> {
      const text = encodeURIComponent((note.title? note.title + '\n\n':'') + note.content);
      // Prefer web WhatsApp; on mobile whatsapp://send?text=...
      const mobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      const waUrl = mobile ? `whatsapp://send?text=${text}` : `https://web.whatsapp.com/send?text=${text}`;
      window.open(waUrl, '_blank');
    });

    dlBtn.addEventListener('click', ()=> {
      const blob = new Blob([ (note.title? note.title + '\n\n' : '') + note.content ], { type: 'text/plain;charset=utf-8' });
      const name = (note.title || 'nota') .replace(/[^\w\s\-]/gi,'').slice(0,40) || 'nota';
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name}.txt`;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
    });

    exportJsonBtn.addEventListener('click', ()=> {
      const data = JSON.stringify([note], null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = `${(note.title||'nota').replace(/[^\w\s\-]/gi,'').slice(0,40)}.json`;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
    });

    notesGrid.appendChild(card);
  });
}

/* helpers */
function escapeHtml(str){ if(!str) return ''; return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function unescapeHtml(str){ if(!str) return ''; return str.replaceAll('&amp;','&').replaceAll('&lt;','<').replaceAll('&gt;','>'); }
let saveTimeouts = {};
function debounceSave(id, titleEl, contentEl, select){
  clearTimeout(saveTimeouts[id]);
  saveTimeouts[id] = setTimeout(()=> {
    const note = NOTES.find(n=>n.id === id);
    if(note){
      note.title = titleEl.innerText.trim();
      note.content = contentEl.innerText.trim();
      note.color = select.value;
      note.updated = Date.now();
      saveNotes();
      renderNotes(searchInput.value);
    }
  }, 480);
}

/* initial demo */
function ensureNotes(){ if(NOTES.length === 0){ createNote({title:'Bem-vindo ao Meu Universo X', content:'Escreve aqui. Usa os bot√µes para partilhar, descarregar e exportar.', color:COLORS[0]}); } }

/* time helper */
function timeAgo(ts){ const s = Math.floor((Date.now() - ts)/1000); if(s < 60) return `${s}s`; if(s < 3600) return `${Math.floor(s/60)}m`; if(s < 86400) return `${Math.floor(s/3600)}h`; return `${Math.floor(s/86400)}d`; }

function placeCaretAtEnd(el) { el.focus(); if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") { const range = document.createRange(); range.selectNodeContents(el); range.collapse(false); const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range); } }

/* open app after login */
function openNotesApp(){
  loadNotes();
  ensureNotes();
  renderNotes();
  notesApp.classList.add('active');
  document.body.style.overflow = 'auto';
  notesApp.style.opacity = '0';
  notesApp.style.transform = 'translateY(8px)';
  setTimeout(()=> { notesApp.style.transition = 'all .48s ease'; notesApp.style.opacity = '1'; notesApp.style.transform = 'translateY(0)'; }, 60);
}

/* create button */
createBtn.addEventListener('click', ()=> createNote({title:'', content:'', color:COLORS[0]}));

/* search */
searchInput.addEventListener('input', ()=> renderNotes(searchInput.value));

/* keyboard shortcut */
document.addEventListener('keydown', (e)=> { if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n'){ e.preventDefault(); createNote({title:'',content:'',color:COLORS[0]}); } });

/* export all JSON (download) */
exportAllBtn.addEventListener('click', ()=> {
  loadNotes();
  const data = JSON.stringify(NOTES, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = `meuuniversox_notas_${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
});

/* download all (same as export) */
downloadAllBtn.addEventListener('click', ()=> exportAllBtn.click());

/* import JSON */
importFile.addEventListener('change', (ev)=>{
  const file = ev.target.files && ev.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    try{
      const parsed = JSON.parse(e.target.result);
      if(!Array.isArray(parsed)) throw new Error('Ficheiro inv√°lido');
      // merge but avoid duplicate ids
      const existingIds = new Set(NOTES.map(n=>n.id));
      parsed.forEach(p=>{
        if(!p.id) p.id = 'n_' + Date.now() + '_' + Math.floor(Math.random()*9999);
        if(existingIds.has(p.id)) p.id = 'n_' + Date.now() + '_' + Math.floor(Math.random()*9999);
        NOTES.unshift(p);
      });
      saveNotes();
      renderNotes();
      alert('Importa√ß√£o conclu√≠da');
    }catch(err){
      alert('Falha a importar: ' + err.message);
    }
  };
  reader.readAsText(file);
  // reset input
  ev.target.value = '';
});

/* =========== Google Drive upload (optional) ===========
  NOTE: This requires an OAuth2 access token with scope:
    https://www.googleapis.com/auth/drive.file
  You can obtain a token via OAuth Playground or your own OAuth client.
  Security: do NOT paste tokens in public places. If unsure, export JSON and upload manually.
====================================================== */
uploadDriveBtn.addEventListener('click', async ()=>{
  const token = (driveTokenInput.value || '').trim();
  if(!token){ alert('Cole o Access Token no campo e tenta novamente, ou exporta o JSON e carrega manualmente no Drive.'); return; }
  // prepare file
  loadNotes();
  const data = JSON.stringify(NOTES, null, 2);
  const metadata = { name: `meuuniversox_notas_${new Date().toISOString().slice(0,10)}.json`, mimeType: 'application/json' };
  try{
    // multipart upload via Drive API: https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart
    const boundary = '-------MUX' + Math.random().toString(36).slice(2);
    const dash = '--';
    const nl = '\r\n';
    let multipart = '';
    multipart += dash + boundary + nl;
    multipart += 'Content-Type: application/json; charset=UTF-8' + nl + nl;
    multipart += JSON.stringify(metadata) + nl;
    multipart += dash + boundary + nl;
    multipart += 'Content-Type: application/json' + nl + nl;
    multipart += data + nl;
    multipart += dash + boundary + dash + nl;

    const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'multipart/related; boundary=' + boundary
      },
      body: multipart
    });
    if(!res.ok){
      const txt = await res.text();
      throw new Error('Erro upload: ' + res.status + ' ‚Äî ' + txt.slice(0,200));
    }
    const result = await res.json();
    alert('Upload conclu√≠do! Ficheiro criado no Drive: ' + (result.name || result.id));
  }catch(err){
    alert('Falha no upload para Drive: ' + err.message + '\nSe n√£o conseguires usar token, exporta JSON e faz upload manual no Drive.');
  }
});

/* load local stored notes now (so import merges correctly) */
loadNotes();

/* Expose simple API: export single note programmatically */
function exportSingleNoteById(id){
  const note = NOTES.find(n=>n.id === id);
  if(!note) return;
  const data = JSON.stringify([note], null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = `${(note.title||'nota').replace(/[^\w\s\-]/gi,'').slice(0,40)}.json`;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
}

/* Small UX: if user reloads show login again but keep notes in localStorage */
/* END */
</script>
</body>
</html>
