<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Universo X</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; overflow-x: hidden; }
    .note-card { transition: transform 0.2s; }
    .note-card:hover { transform: scale(1.05); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-4 { display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-gray-950 text-white">

<!-- Splash Screen -->
<div id="splash" class="fixed inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center z-50">
  <div class="text-center animate-pulse">
    <img src="https://i.imgur.com/your-image.png" alt="Cientista" class="w-48 h-48 mx-auto mb-6 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
    <div class="text-8xl mb-4" style="display:none">üêµ</div>
    <h1 class="text-5xl font-bold text-white mb-2">Meu Universo X</h1>
    <p class="text-xl text-indigo-200">Suas ideias conectadas</p>
  </div>
</div>

<!-- App -->
<div id="app" style="display:none">
  <!-- Header -->
  <div class="bg-gray-900 border-b border-gray-800 p-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
      <div class="flex items-center gap-3">
        <img src="https://i.imgur.com/your-image.png" alt="Cientista" class="w-10 h-10 object-contain" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%220.9em%22 font-size=%2290%22>üêµ</text></svg>'">
        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-pink-400 bg-clip-text text-transparent">Meu Universo X</h1>
      </div>
      
      <div class="flex items-center gap-2 flex-1 max-w-md">
        <div class="relative flex-1">
          <input id="searchInput" type="text" placeholder="Buscar notas..." class="w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:border-indigo-500">
        </div>
      </div>
      
      <div class="flex items-center gap-2">
        <button id="btnAdd" class="p-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition">‚ûï</button>
        <button id="btnGrid" class="p-2 bg-indigo-600 rounded-lg transition">üìä</button>
        <button id="btnGraph" class="p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">üåê</button>
        <button id="btnExport" class="p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">‚¨áÔ∏è</button>
        <label class="p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition cursor-pointer">
          ‚¨ÜÔ∏è
          <input type="file" id="importFile" accept=".json" class="hidden">
        </label>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="max-w-7xl mx-auto p-4">
    <!-- Grid View -->
    <div id="gridView" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    
    <!-- Graph View -->
    <div id="graphView" style="display:none" class="relative">
      <canvas id="canvas3d" class="w-full rounded-lg" style="height:600px"></canvas>
      <div class="absolute top-4 left-4 bg-gray-900 bg-opacity-90 p-4 rounded-lg">
        <p class="text-sm text-gray-300">üîÆ Clique nas esferas para abrir notas</p>
        <p class="text-sm text-gray-400">‚ú® Conex√µes = hashtags em comum</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-40" style="display:none">
  <div class="bg-gray-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-start mb-4">
        <div class="flex-1">
          <div id="viewMode">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4"></h2>
            <p id="modalContent" class="text-gray-300 whitespace-pre-wrap"></p>
            <div id="modalTags" class="mt-4 flex flex-wrap gap-2"></div>
          </div>
          <div id="editMode" style="display:none">
            <input id="editTitle" type="text" class="w-full text-2xl font-bold bg-gray-800 border border-gray-700 rounded px-3 py-2 mb-3">
            <div class="flex items-center gap-2 mb-3">
              <button id="btnColorPicker" class="p-2 rounded-lg border-2 transition">üé®</button>
              <div id="colorPicker" class="flex flex-wrap gap-2 p-2 bg-gray-800 rounded-lg" style="display:none"></div>
            </div>
            <textarea id="editContent" class="w-full h-64 bg-gray-800 border border-gray-700 rounded px-3 py-2 resize-none" placeholder="Escreva sua nota... Use #hashtags!"></textarea>
          </div>
        </div>
        <button id="btnCloseModal" class="ml-4 p-2 hover:bg-gray-800 rounded">‚úñÔ∏è</button>
      </div>

      <div class="flex flex-wrap gap-2 mt-6 pt-4 border-t border-gray-800">
        <button id="btnEdit" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg">‚úèÔ∏è Editar</button>
        <button id="btnSave" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg" style="display:none">üíæ Salvar</button>
        <button id="btnDelete" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg">üóëÔ∏è Excluir</button>
        <div class="flex gap-2 ml-auto flex-wrap">
          <button onclick="shareNote('whatsapp')" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm">WhatsApp</button>
          <button onclick="shareNote('telegram')" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm">Telegram</button>
          <button onclick="shareNote('email')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">Email</button>
          <button onclick="exportNote('txt')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">TXT</button>
          <button onclick="exportNote('md')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm">MD</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Estado da aplica√ß√£o
let notes = [];
let currentNote = null;
let scene, camera, renderer, noteMeshes = [];
let animationFrame;
const colors = ['#ef4444','#f97316','#f59e0b','#eab308','#84cc16','#22c55e','#10b981','#14b8a6','#06b6d4','#0ea5e9','#3b82f6','#6366f1','#8b5cf6','#a855f7','#d946ef','#ec4899','#f43f5e','#64748b','#78716c','#a3a3a3'];

// Inicializa√ß√£o
setTimeout(() => {
  document.getElementById('splash').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  loadNotes();
  renderGrid();
}, 2500);

function loadNotes() {
  const stored = localStorage.getItem('meuUniversoX');
  if (stored) notes = JSON.parse(stored);
}

function saveNotes() {
  localStorage.setItem('meuUniversoX', JSON.stringify(notes));
}

function extractHashtags(text) {
  return text.match(/#[\w\u00C0-\u017F]+/g) || [];
}

function renderGrid() {
  const grid = document.getElementById('gridView');
  const search = document.getElementById('searchInput').value.toLowerCase();
  const filtered = notes.filter(n => 
    n.title.toLowerCase().includes(search) || 
    n.content.toLowerCase().includes(search)
  );
  
  grid.innerHTML = filtered.map(note => `
    <div class="note-card p-4 rounded-lg shadow-lg cursor-pointer border-2" 
         style="background-color:${note.color}20; border-color:${note.color}"
         onclick="openNote(${note.id})">
      <h3 class="font-bold text-lg mb-2 line-clamp-2">${note.title}</h3>
      <p class="text-sm text-gray-300 line-clamp-4">${note.content}</p>
      <div class="mt-3 flex flex-wrap gap-1">
        ${extractHashtags(note.title + ' ' + note.content).map(tag => 
          `<span class="text-xs px-2 py-1 bg-indigo-600 rounded-full">${tag}</span>`
        ).join('')}
      </div>
    </div>
  `).join('');
}

function openNote(id) {
  currentNote = notes.find(n => n.id === id);
  if (!currentNote) return;
  
  document.getElementById('modalTitle').textContent = currentNote.title;
  document.getElementById('modalContent').textContent = currentNote.content;
  document.getElementById('modalTags').innerHTML = extractHashtags(currentNote.title + ' ' + currentNote.content)
    .map(tag => `<span class="px-3 py-1 bg-indigo-600 rounded-full text-sm">${tag}</span>`).join('');
  
  document.getElementById('viewMode').style.display = 'block';
  document.getElementById('editMode').style.display = 'none';
  document.getElementById('btnEdit').style.display = 'block';
  document.getElementById('btnSave').style.display = 'none';
  document.getElementById('modal').style.display = 'flex';
}

// Event Listeners
document.getElementById('btnAdd').onclick = () => {
  const newNote = {
    id: Date.now(),
    title: 'Nova Nota',
    content: '',
    color: colors[Math.floor(Math.random() * colors.length)],
    created: new Date().toISOString()
  };
  notes.unshift(newNote);
  saveNotes();
  renderGrid();
  openNote(newNote.id);
  document.getElementById('btnEdit').click();
};

document.getElementById('btnGrid').onclick = () => {
  document.getElementById('gridView').style.display = 'grid';
  document.getElementById('graphView').style.display = 'none';
  document.getElementById('btnGrid').className = 'p-2 bg-indigo-600 rounded-lg transition';
  document.getElementById('btnGraph').className = 'p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition';
};

document.getElementById('btnGraph').onclick = () => {
  document.getElementById('gridView').style.display = 'none';
  document.getElementById('graphView').style.display = 'block';
  document.getElementById('btnGraph').className = 'p-2 bg-indigo-600 rounded-lg transition';
  document.getElementById('btnGrid').className = 'p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition';
  initThreeJS();
};

document.getElementById('btnEdit').onclick = () => {
  document.getElementById('editTitle').value = currentNote.title;
  document.getElementById('editContent').value = currentNote.content;
  document.getElementById('viewMode').style.display = 'none';
  document.getElementById('editMode').style.display = 'block';
  document.getElementById('btnEdit').style.display = 'none';
  document.getElementById('btnSave').style.display = 'block';
  
  const picker = document.getElementById('colorPicker');
  picker.innerHTML = colors.map(c => 
    `<button onclick="setColor('${c}')" class="w-8 h-8 rounded-full border-2 border-gray-700 hover:scale-110 transition" style="background-color:${c}"></button>`
  ).join('');
};

document.getElementById('btnColorPicker').onclick = () => {
  const picker = document.getElementById('colorPicker');
  picker.style.display = picker.style.display === 'none' ? 'flex' : 'none';
};

function setColor(color) {
  currentNote.color = color;
  document.getElementById('btnColorPicker').style.borderColor = color;
  document.getElementById('btnColorPicker').style.backgroundColor = color + '30';
}

document.getElementById('btnSave').onclick = () => {
  currentNote.title = document.getElementById('editTitle').value;
  currentNote.content = document.getElementById('editContent').value;
  saveNotes();
  renderGrid();
  openNote(currentNote.id);
};

document.getElementById('btnDelete').onclick = () => {
  if (confirm('Excluir esta nota?')) {
    notes = notes.filter(n => n.id !== currentNote.id);
    saveNotes();
    renderGrid();
    document.getElementById('modal').style.display = 'none';
  }
};

document.getElementById('btnCloseModal').onclick = () => {
  document.getElementById('modal').style.display = 'none';
};

document.getElementById('searchInput').oninput = renderGrid;

document.getElementById('btnExport').onclick = () => {
  const data = JSON.stringify(notes, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'meu-universo-x-backup.json';
  a.click();
};

document.getElementById('importFile').onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const imported = JSON.parse(event.target.result);
        notes = [...imported, ...notes];
        saveNotes();
        renderGrid();
      } catch (err) {
        alert('Erro ao importar arquivo');
      }
    };
    reader.readAsText(file);
  }
};

function shareNote(platform) {
  const text = `${currentNote.title}\n\n${currentNote.content}`;
  const encoded = encodeURIComponent(text);
  const urls = {
    whatsapp: `https://wa.me/?text=${encoded}`,
    telegram: `https://t.me/share/url?text=${encoded}`,
    email: `mailto:?subject=${encodeURIComponent(currentNote.title)}&body=${encoded}`
  };
  window.open(urls[platform], '_blank');
}

function exportNote(format) {
  let content = '', filename = '';
  if (format === 'txt') {
    content = `${currentNote.title}\n\n${currentNote.content}`;
    filename = `${currentNote.title}.txt`;
  } else if (format === 'md') {
    content = `# ${currentNote.title}\n\n${currentNote.content}`;
    filename = `${currentNote.title}.md`;
  }
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
}

// Three.js
function initThreeJS() {
  if (scene) return;
  
  const canvas = document.getElementById('canvas3d');
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0a0a0f);
  
  camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
  camera.position.z = 30;
  
  renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  
  const particlesGeometry = new THREE.BufferGeometry();
  const positions = new Float32Array(3000);
  for (let i = 0; i < 3000; i++) positions[i] = (Math.random() - 0.5) * 100;
  particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  const particles = new THREE.Points(particlesGeometry, new THREE.PointsMaterial({ color: 0x4a5568, size: 0.1 }));
  scene.add(particles);
  
  const light = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(light);
  
  canvas.onclick = onCanvasClick;
  updateGraph();
  animate();
}

function updateGraph() {
  if (!scene) return;
  
  noteMeshes.forEach(m => {
    scene.remove(m);
    if (m.geometry) m.geometry.dispose();
    if (m.material) m.material.dispose();
  });
  noteMeshes = [];
  
  const search = document.getElementById('searchInput').value.toLowerCase();
  const filtered = notes.filter(n => 
    n.title.toLowerCase().includes(search) || 
    n.content.toLowerCase().includes(search)
  );
  
  const hashtagMap = {};
  filtered.forEach(note => {
    const tags = extractHashtags(note.title + ' ' + note.content);
    tags.forEach(tag => {
      if (!hashtagMap[tag]) hashtagMap[tag] = [];
      hashtagMap[tag].push(note.id);
    });
  });
  
  const radius = 15;
  filtered.forEach((note, i) => {
    const angle = (i / filtered.length) * Math.PI * 2;
    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius;
    const z = (Math.random() - 0.5) * 10;
    
    const geometry = new THREE.SphereGeometry(0.8, 16, 16);
    const material = new THREE.MeshPhongMaterial({ 
      color: note.color,
      emissive: search && (note.title.toLowerCase().includes(search) || note.content.toLowerCase().includes(search)) ? note.color : 0x000000,
      emissiveIntensity: 0.5,
      shininess: 100
    });
    const sphere = new THREE.Mesh(geometry, material);
    sphere.position.set(x, y, z);
    sphere.userData = { noteId: note.id, originalY: y };
    scene.add(sphere);
    noteMeshes.push(sphere);
  });
  
  Object.values(hashtagMap).forEach(noteIds => {
    if (noteIds.length > 1) {
      for (let i = 0; i < noteIds.length; i++) {
        for (let j = i + 1; j < noteIds.length; j++) {
          const m1 = noteMeshes.find(m => m.userData.noteId === noteIds[i]);
          const m2 = noteMeshes.find(m => m.userData.noteId === noteIds[j]);
          if (m1 && m2) {
            const points = [m1.position.clone(), m2.position.clone()];
            const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x8b5cf6, transparent: true, opacity: 0.4 });
            const line = new THREE.Line(lineGeometry, lineMaterial);
            line.userData = { mesh1: m1, mesh2: m2, isConnection: true };
            scene.add(line);
            noteMeshes.push(line);
          }
        }
      }
    }
  });
}

function animate() {
  animationFrame = requestAnimationFrame(animate);
  if (camera && scene) {
    camera.rotation.y += 0.001;
    noteMeshes.forEach(mesh => {
      if (mesh.geometry && mesh.geometry.type === 'SphereGeometry') {
        mesh.position.y = mesh.userData.originalY + Math.sin(Date.now() * 0.001 + mesh.position.x) * 0.3;
        mesh.rotation.y += 0.01;
      }
      if (mesh.userData && mesh.userData.isConnection) {
        const pos = mesh.geometry.attributes.position.array;
        pos[0] = mesh.userData.mesh1.position.x;
        pos[1] = mesh.userData.mesh1.position.y;
        pos[2] = mesh.userData.mesh1.position.z;
        pos[3] = mesh.userData.mesh2.position.x;
        pos[4] = mesh.userData.mesh2.position.y;
        pos[5] = mesh.userData.mesh2.position.z;
        mesh.geometry.attributes.position.needsUpdate = true;
      }
    });
    renderer?.render(scene, camera);
  }
}

function onCanvasClick(e) {
  if (!camera || !scene) return;
  const canvas = document.getElementById('canvas3d');
  const rect = canvas.getBoundingClientRect();
  const mouse = new THREE.Vector2(
    ((e.clientX - rect.left) / rect.width) * 2 - 1,
    -((e.clientY - rect.top) / rect.height) * 2 + 1
  );
  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse, camera);
  const spheres = noteMeshes.filter(m => m.geometry?.type === 'SphereGeometry');
  const intersects = raycaster.intersectObjects(spheres);
  if (intersects.length > 0) {
    const noteId = intersects[0].object.userData.noteId;
    document.getElementById('btnGrid').click();
    setTimeout(() => openNote(noteId), 100);
  }
}
</script>

</body>
</html>
